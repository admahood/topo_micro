requireNamespace("dplyr")
requireNamespace("lubridate")
top <- readr::read_csv(filename,n_max = 1)
bottom <- read.csv(filename) %>%
dplyr::slice(3:nrow(.)) |>
dplyr::select(index =1, date=2, temperature =3, humidity=4, dewpoint=5 ) |>
tibble::as_tibble() |>
dplyr::mutate_at(3:5, as.numeric) |>
tidyr::separate(date, sep = " ",
into = c("weekday", "month", "mday", "year", "hms", "tz", "tzv"),
extra = "merge") |>
dplyr::mutate(dt = lubridate::ymd_hms(paste(year, month, mday, hms, sep="-")),
ymd = lubridate::as_date(dt)) |>
dplyr::rename(temperature_c = temperature,
humidity_pct = humidity,
dewpoint_c = dewpoint) |>
dplyr::mutate(id = top$Name,
dl_date = top$Download_Date)
lubridate::tz(bottom$dt) <- "US/Mountain"
return(bottom)
}
#' of the raster is in degrees
#'
#' @examples
#' data('dem_meters')
#' x <- get_twi(dem_meters)
#'
#' data('dem_deg')
#' xx <- get_twi(dem_deg, resolution = 30)
#'
#' @export
get_twi <- function(dem, deg = 0.12, fill.sinks=T, resolution=NA){
requireNamespace("terra")
requireNamespace("topmodel")
if(class(dem)|>as.character() == "RasterLayer") dem <- terra::rast(dem)
if(is.na(resolution)) resolution <- terra::xres(dem)
if (fill.sinks) {
capture.output(dem1 <- invisible(terra::setValues(dem,
topmodel::sinkfill(terra::as.matrix(dem, wide = T),
res = resolution,
degree = deg))))
}else{dem1 <- dem}
ti <- topmodel::topidx(terra::as.matrix(dem1, wide=T), res = resolution)
a <- terra::setValues(dem1, ti$area)
a <- log(a + 1)
atb <- terra::setValues(dem1, ti$atb)
a <- c(dem1, a, atb)
names(a) <- c("elevation","upslope_area", "twi")
return(a)
}
#' Saturation pressure
#'
#' Thanks https://physics.stackexchange.com/questions/4343/how-can-i-calculate-vapor-pressure-deficit-from-temperature-and-relative-humidit
#'
#' @param temp_c temperature
#' @export
get_es <- function(temp_c){
es <- 6.11 * exp((2.5e6 / 461) * (1 / 273.15 - 1 / (273.15 + temp_c)))
return(es)
}
#' Vapor pressure deficit
#'
#' Thanks https://physics.stackexchange.com/questions/4343/how-can-i-calculate-vapor-pressure-deficit-from-temperature-and-relative-humidit
#'
#' @param temp_c temperature
#' @param rh relative humidity
#' @export
get_vpd <- function(rh, temp_c){
## calculate saturation vapor pressure
es <- get_es(temp_c)
## calculate vapor pressure deficit
vpd <- ((100 - rh) / 100) * es
return(vpd)
}
load_all()
document()
load_all()
document()
load_all()
document()
check()
document()
data(dem_deg)
save(dem_deg, "data/dem_deg.rda", compress = "bzip")
save(dem_deg, file= "data/dem_deg.rda", compress = "bzip")
save(dem_deg, file= "data/dem_deg.rda", compress = T)
load_all()
document()
save(dem_deg |> as("Raster"), file= "data/dem_deg.rda", compress = T)
library(raster)
save(dem_deg |> as("Raster"), file= "data/dem_deg.rda", compress = T)
save(as(dem_deg,"Raster"), file= "data/dem_deg.rda", compress = T)
save(as(dem_deg,"RasterLayer"), file= "data/dem_deg.rda", compress = T)
dem_deg
load_all()
document()
document()
check()
load_all()
document()
check()
install()
library(devtools)
load_all()
document()
check()
install()
load_all()
document()
install()
library(devtools)
load_all()
document()
check()
install()
library(devtools)
load_all()
check()
install()
document()
update.packages(ask=F)
library(devtools)
document()
?terra::rast
?terra::rast
document()
load_all()
check()
check()
load_all()
document()
check()
load_all()
document()
check()
devtools::install_github('admahood/topomicro')
detach('package::topomicro')
detach('package:topomicro')
devtools::install_github('admahood/topomicro')
st_df <- NA
class(st_df)
class(data.frame(a=1))
class(tibble(a=1))
class(tibble::tibble(a=1))
class(tibble::tibble(a=1)) %in% "data.frame"
class(tibble::tibble(a=1)) %in% "data.frame" |> any()
data('mef_micro_data')
data('mef_station_data')
mef_station_data
df <- mef_micro_data
std_df <- mef_station_data
std_df <- dplyr::select(mef_station_data, temperature_c = ta_avg_c_avg, humidity_pct = rh_avg_percent_avg) |> mutate(vpd_kPa = topomicro::get_vpd(humidity_pct, temperature_c))
std_df <- dplyr::select(mef_station_data, temperature_c = ta_avg_c_avg, humidity_pct = rh_avg_percent_avg) |> dplyr::mutate(vpd_kPa = topomicro::get_vpd(humidity_pct, temperature_c))
std_df
std_df <- dplyr::select(mef_station_data, temperature_c = ta_avg_c_avg, humidity_pct = rh_avg_percent_avg, timestamp_ts) |> dplyr::mutate(vpd_kPa = topomicro::get_vpd(humidity_pct, temperature_c), ymd = lubridate::ymd(timestamp_ts))
std_df <- dplyr::select(mef_station_data, temperature_c = ta_avg_c_avg, humidity_pct = rh_avg_percent_avg, timestamp_ts) |> dplyr::mutate(vpd_kPa = topomicro::get_vpd(humidity_pct, temperature_c))
sttd_df
std_df
mef_micro_data
std_df |> summary()
library(tidyverse)
std_df |>
mutate(ymd = as.Date(str_sub(timestamp_ts, 1,10)))
std_df |>
mutate(ymd = as.Date(str_sub(timestamp_ts, 1,10))) |>
save(file = "data/mef_station_data.rda", compress = 'xz')
mef_station_data <- std_df |>
mutate(ymd = as.Date(str_sub(timestamp_ts, 1,10)))
save(mef_station_data, file = "data/mef_station_data.rda", compress = 'xz')
std <- mef_station_data
std <- std_df |>
dplyr::select(t_std = temperature_c,
rh_std = humidity_pct,
v_std = vpd_kPa,
ymd)
mef_station_data
std <- mef_station_data
std_df <- mef_station_data
std <- std_df |>
dplyr::select(t_std = temperature_c,
rh_std = humidity_pct,
v_std = vpd_kPa,
ymd)
std
df <- mef_micro_data
df |>
dplyr::group_by(ymd, id) |>
left_join(std)
df |>
dplyr::mutate(dt = lubridate::floor_date(unit = "hour"))
df |>
dplyr::mutate(dt = lubridate::floor_date(dt, unit = "hour"))
std <- std_df |>
dplyr::select(t_std = temperature_c,
rh_std = humidity_pct,
v_std = vpd_kPa,
ymd, dt = timestamp_ts)|>
dplyr::mutate(dt = lubridate::floor_date(dt, unit = "hour"))
df |>
dplyr::mutate(dt = lubridate::floor_date(dt, unit = "hour")) |>
dplyr::group_by(ymd, id) |>
left_join(std)
df |>
dplyr::mutate(dt = lubridate::floor_date(dt, unit = "hour")) |>
dplyr::group_by(ymd, id) |>
left_join(std) |> summary()
std <- std_df |>
dplyr::select(t_std = temperature_c,
rh_std = humidity_pct,
v_std = vpd_kPa,
ymd) |>
dplyr::group_by(ymd, id) |>
dplyr::summarise(tmean = mean(temperature_c),
tmax = max(temperature_c),
tmin= min(temperature_c),
tdelta = tmax - tmin,
vmean = mean(vpd_kPa),
vmax = max(vpd_kPa),
vmin= min(vpd_kPa),
vdelta = vmax - vmin,
rmean = mean(humidity_pct),
rmax = max(humidity_pct),
rmin= min(humidity_pct),
rdelta = rmax - rmin) |>
dplyr::ungroup()
std <- std_df |>
dplyr::select(t_std = temperature_c,
rh_std = humidity_pct,
v_std = vpd_kPa,
ymd) |>
dplyr::group_by(ymd) |>
dplyr::summarise(tmean = mean(temperature_c),
tmax = max(temperature_c),
tmin= min(temperature_c),
tdelta = tmax - tmin,
vmean = mean(vpd_kPa),
vmax = max(vpd_kPa),
vmin= min(vpd_kPa),
vdelta = vmax - vmin,
rmean = mean(humidity_pct),
rmax = max(humidity_pct),
rmin= min(humidity_pct),
rdelta = rmax - rmin) |>
dplyr::ungroup()
std <- std_df |>
dplyr::group_by(ymd) |>
dplyr::summarise(tmean = mean(temperature_c),
tmax = max(temperature_c),
tmin= min(temperature_c),
tdelta = tmax - tmin,
vmean = mean(vpd_kPa),
vmax = max(vpd_kPa),
vmin= min(vpd_kPa),
vdelta = vmax - vmin,
rmean = mean(humidity_pct),
rmax = max(humidity_pct),
rmin= min(humidity_pct),
rdelta = rmax - rmin) |>
dplyr::ungroup()
std
std <- std_df |>
dplyr::group_by(ymd) |>
dplyr::summarise(stmean = mean(temperature_c),
stmax = max(temperature_c),
stmin= min(temperature_c),
stdelta = tmax - tmin,
svmean = mean(vpd_kPa),
svmax = max(vpd_kPa),
svmin= min(vpd_kPa),
svdelta = vmax - vmin,
srmean = mean(humidity_pct),
srmax = max(humidity_pct),
srmin= min(humidity_pct),
srdelta = rmax - rmin) |>
dplyr::ungroup()
std <- std_df |>
dplyr::group_by(ymd) |>
dplyr::summarise(stmean = mean(temperature_c),
stmax = max(temperature_c),
stmin= min(temperature_c),
stdelta = stmax - stmin,
svmean = mean(vpd_kPa),
svmax = max(vpd_kPa),
svmin= min(vpd_kPa),
svdelta = svmax - svmin,
srmean = mean(humidity_pct),
srmax = max(humidity_pct),
srmin= min(humidity_pct),
srdelta = srmax - srmin) |>
dplyr::ungroup()
std
df |>
dplyr::group_by(ymd, id) |>
dplyr::summarise(tmean = mean(temperature_c),
tmax = max(temperature_c),
tmin= min(temperature_c),
tdelta = tmax - tmin,
vmean = mean(vpd_kPa),
vmax = max(vpd_kPa),
vmin= min(vpd_kPa),
vdelta = vmax - vmin,
rmean = mean(humidity_pct),
rmax = max(humidity_pct),
rmin= min(humidity_pct),
rdelta = rmax - rmin) |>
dplyr::ungroup()
std_df |>
dplyr::group_by(ymd) |>
dplyr::summarise(stmean = mean(temperature_c),
stmax = max(temperature_c),
stmin= min(temperature_c),
stdelta = stmax - stmin,
svmean = mean(vpd_kPa),
svmax = max(vpd_kPa),
svmin= min(vpd_kPa),
svdelta = svmax - svmin,
srmean = mean(humidity_pct),
srmax = max(humidity_pct),
srmin= min(humidity_pct),
srdelta = srmax - srmin) |>
dplyr::ungroup()
df |>
dplyr::group_by(ymd, id) |>
dplyr::summarise(tmean = mean(temperature_c),
tmax = max(temperature_c),
tmin= min(temperature_c),
tdelta = tmax - tmin,
vmean = mean(vpd_kPa),
vmax = max(vpd_kPa),
vmin= min(vpd_kPa),
vdelta = vmax - vmin,
rmean = mean(humidity_pct),
rmax = max(humidity_pct),
rmin= min(humidity_pct),
rdelta = rmax - rmin) |>
dplyr::ungroup()
df |>
dplyr::group_by(ymd, id) |>
dplyr::summarise(tmean = mean(temperature_c),
tmax = max(temperature_c),
tmin= min(temperature_c),
tdelta = tmax - tmin,
vmean = mean(vpd_kPa),
vmax = max(vpd_kPa),
vmin= min(vpd_kPa),
vdelta = vmax - vmin,
rmean = mean(humidity_pct),
rmax = max(humidity_pct),
rmin= min(humidity_pct),
rdelta = rmax - rmin) |>
dplyr::ungroup() |>
dplyr::left_join(std)
df |>
dplyr::group_by(ymd, id) |>
dplyr::summarise(tmean = mean(temperature_c),
tmax = max(temperature_c),
tmin= min(temperature_c),
tdelta = tmax - tmin,
vmean = mean(vpd_kPa),
vmax = max(vpd_kPa),
vmin= min(vpd_kPa),
vdelta = vmax - vmin,
rmean = mean(humidity_pct),
rmax = max(humidity_pct),
rmin= min(humidity_pct),
rdelta = rmax - rmin) |>
dplyr::ungroup() |>
dplyr::left_join(std) |>
dplyr::mutate(stmean = tmean - smean,
stmax  = tmax - stmax,
stmin = tmin - stmin,
stdelta = tdelta - stdelta,
svmean = vmean - svmean,
svmax = vmax - svmax,
svmin = vmin - svmin,
svdelta = vdelta - svdelta,
srmean = rmean - srmean,
srmax = rmax = srmax,
df |>
dplyr::group_by(ymd, id) |>
dplyr::summarise(tmean = mean(temperature_c),
tmax = max(temperature_c),
tmin= min(temperature_c),
tdelta = tmax - tmin,
vmean = mean(vpd_kPa),
vmax = max(vpd_kPa),
vmin= min(vpd_kPa),
vdelta = vmax - vmin,
rmean = mean(humidity_pct),
rmax = max(humidity_pct),
rmin= min(humidity_pct),
rdelta = rmax - rmin) |>
dplyr::ungroup() |>
dplyr::left_join(std) |>
dplyr::mutate(stmean = tmean - smean,
stmax  = tmax - stmax,
stmin = tmin - stmin,
stdelta = tdelta - stdelta,
svmean = vmean - svmean,
svmax = vmax - svmax,
svmin = vmin - svmin,
svdelta = vdelta - svdelta,
srmean = rmean - srmean,
srmax = rmax - srmax,
srmin = rmin - srmin,
srdelta = rdelta - srdelta) |>
dplyr::select(-ymd) |>
dplyr::group_by(id) |>
dplyr::summarise_all(mean) |>
dplyr::ungroup() |>
dplyr::arrange(id) |>
tibble::column_to_rownames("id")
df |>
dplyr::group_by(ymd, id) |>
dplyr::summarise(tmean = mean(temperature_c),
tmax = max(temperature_c),
tmin= min(temperature_c),
tdelta = tmax - tmin,
vmean = mean(vpd_kPa),
vmax = max(vpd_kPa),
vmin= min(vpd_kPa),
vdelta = vmax - vmin,
rmean = mean(humidity_pct),
rmax = max(humidity_pct),
rmin= min(humidity_pct),
rdelta = rmax - rmin) |>
dplyr::ungroup() |>
dplyr::left_join(std) |>
dplyr::mutate(stmean = tmean - stmean,
stmax  = tmax - stmax,
stmin = tmin - stmin,
stdelta = tdelta - stdelta,
svmean = vmean - svmean,
svmax = vmax - svmax,
svmin = vmin - svmin,
svdelta = vdelta - svdelta,
srmean = rmean - srmean,
srmax = rmax - srmax,
srmin = rmin - srmin,
srdelta = rdelta - srdelta) |>
dplyr::select(-ymd) |>
dplyr::group_by(id) |>
dplyr::summarise_all(mean) |>
dplyr::ungroup() |>
dplyr::arrange(id) |>
tibble::column_to_rownames("id")
df |>
dplyr::group_by(ymd, id) |>
dplyr::summarise(tmean = mean(temperature_c),
tmax = max(temperature_c),
tmin= min(temperature_c),
tdelta = tmax - tmin,
vmean = mean(vpd_kPa),
vmax = max(vpd_kPa),
vmin= min(vpd_kPa),
vdelta = vmax - vmin,
rmean = mean(humidity_pct),
rmax = max(humidity_pct),
rmin= min(humidity_pct),
rdelta = rmax - rmin) |>
dplyr::ungroup() |>
dplyr::left_join(std) |> summary()
df |>
dplyr::group_by(ymd, id) |>
dplyr::summarise(tmean = mean(temperature_c),
tmax = max(temperature_c),
tmin= min(temperature_c),
tdelta = tmax - tmin,
vmean = mean(vpd_kPa),
vmax = max(vpd_kPa),
vmin= min(vpd_kPa),
vdelta = vmax - vmin,
rmean = mean(humidity_pct),
rmax = max(humidity_pct),
rmin= min(humidity_pct),
rdelta = rmax - rmin) |>
dplyr::ungroup() |>
dplyr::left_join(std) |>
dplyr::filter(!is.na(stmean)) |>
dplyr::mutate(stmean = tmean - stmean,
stmax  = tmax - stmax,
stmin = tmin - stmin,
stdelta = tdelta - stdelta,
svmean = vmean - svmean,
svmax = vmax - svmax,
svmin = vmin - svmin,
svdelta = vdelta - svdelta,
srmean = rmean - srmean,
srmax = rmax - srmax,
srmin = rmin - srmin,
srdelta = rdelta - srdelta) |>
dplyr::select(-ymd) |>
dplyr::group_by(id) |>
dplyr::summarise_all(mean) |>
dplyr::ungroup() |>
dplyr::arrange(id) |>
tibble::column_to_rownames("id")
library(devtools)
mef_station_data
load_all()
document()
check()
load_all();document();check()
load_all();document();check()
load_all();document();check()
load_all();document();check()
load_all();document();check()
data('mef_station_data')
data('mef_micro_data')
plotwise_summary(mef_micro_data)
plotwise_summary_std(mef_micro_data, mef_station_data)
install()
